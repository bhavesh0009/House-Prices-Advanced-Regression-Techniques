---
title: "Kaggle House prize prediction"
output: html_notebook
---

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(data.table)
library(knitr)
require(cowplot)
```

```{r}
setwd("D:/Kaggle/House Prices Advanced Regression Techniques")
```

```{r}
train <- fread("train.csv", stringsAsFactors = TRUE)
test <- fread("test.csv", stringsAsFactors = TRUE)
```

```{r}
kable(head(train))
```

```{r}
train_nulls <- as.data.frame(colSums(is.na(train)))#as.data.frame(sapply(X = train, FUN = function(x) sum(is.na(x))))
train_nulls <- add_rownames(train_nulls, "Column")
colnames(train_nulls)[2] <- "nulls"
train_nulls$notNulls = nrow(train) - train_nulls$nulls
```

```{r}
train_nulls %>%
  filter(nulls > 0) %>%
  gather("null_flag", "count", -Column) %>%
  ggplot(aes(x = Column, y = count, fill = null_flag)) +
  geom_bar(stat = "identity",position = "fill") +
  theme(legend.position = "bottom") +
  coord_flip()
```

```{r}
# Converting subclass to factor
train$MSSubClass = as.factor(train$MSSubClass)
```

```{r}
# Visualizing sale price vs MsSubClass
ggplot(train, aes(x = MSSubClass, y = SalePrice)) +
  geom_boxplot()
```

```{r}
# visualize number of observation for each category
ggplot(train, aes(x = MSSubClass, fill = MSSubClass)) +
  geom_bar()
```

```{r}
# visualize number of observation for each category
ggplot(train, aes(x = MSZoning)) +
  geom_bar()
```

```{r}
# Visualizing sale price vs MsSubClass
ggplot(train, aes(x = MSZoning, y = SalePrice)) +
  geom_boxplot()
```

```{r}

plot1 <- ggplot(train, aes(x = LotFrontage)) +
            geom_histogram(binwidth = 10) 

# Visualizing sale price vs LotFrontage
plot2 <- ggplot(train, aes(x = LotFrontage, y = SalePrice)) +
          geom_point() +
          geom_smooth(method = "lm") 

plot_grid(plot1, plot2, align='h')

```
```{r}
ggplot(train, aes(x =log( LotArea), y = SalePrice)) +
  geom_point() +
  geom_smooth(method = "lm")
```

```{r}
# Strong relation ship between lot area and sale price
# Creating new feature for prize per square feet
train$psf <- train$SalePrice / train$LotArea
```

```{r}
train %>%
  group_by(Street) %>%
  summarise(count = n())
```

```{r}
# Too less values for Grvl. We can ignore that, but Let's first check box-plot if gravel can explain outliers?
ggplot(train, aes(x = Street, y = psf)) +
  geom_violin(fill = "red")
```

```{r}
train %>%
  group_by(Alley) %>%
  summarise(count = n())
```

```{r}
# Too many null values , but here NA means no alley access, can be good feature. Let's change value for that.
train[is.na(Alley)]$Alley = "No"
```

```{r}
# Too less values for Grvl. We can ignore that, but Let's first check box-plot if gravel can explain outliers?
ggplot(train, aes(x = Alley, y = psf, fill = Alley)) +
  geom_boxplot()
```

```{r}
train %>%
  group_by(LotShape) %>%
  summarise(count = n(),
            avg = mean(psf))
```

```{r}
# IR3 should have least prize, Reg highest in my opinion. Let's check
ggplot(train, aes(x = LotShape, y = psf, fill = LotShape)) +
  geom_boxplot()
```

```{r}
train %>%
  group_by(LandContour) %>%
  summarise(count = n(),
            avg = mean(psf))
```

```{r}
train %>%
  group_by(Utilities) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  arrange(desc(count), desc(avg))
# Conclusion : We can ignore this variable.
```

```{r}
train %>%
  group_by(LotConfig) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  arrange(desc(count), desc(avg))
# Conclusion : Hmmm...
```

```{r}
train %>%
  group_by(LandSlope) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  arrange(desc(count), desc(avg))
# Conclusion : Nice One!! Speically we can penalize Sev slopes
```

```{r}
train %>%
  group_by(Neighborhood) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  arrange(desc(count), desc(avg))
```

```{r}
ggplot(train, aes(x = Neighborhood, y = psf, fill = Neighborhood)) +
  geom_boxplot() +
  coord_flip() +
  theme(legend.position = "none")
# Conclustion : Definetely a differentiator
```

```{r}
train %>%
  group_by(Condition1) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  arrange(desc(avg), desc(count))
# Conclustion : People don't like building adjacent to rail roads or streets.
```

```{r}
train %>%
  group_by(Condition2) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  arrange(desc(avg), desc(count))
# Need to mix it with condition 1 to get better result
```

```{r}
train %>%
  group_by(BldgType) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  arrange(desc(avg), desc(count)) 
# Conclusion : Superb Feature
```

```{r}
train %>%
  group_by(HouseStyle) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  arrange(desc(avg), desc(count)) 
```

```{r}
ggplot(train, aes(x = HouseStyle, y = psf, fill = HouseStyle)) +
  geom_boxplot() +
  theme(legend.position = "none")
# Conclusion : 2 story getting premium prize
```

```{r}
train$OverallQual = as.factor(train$OverallQual)
train %>%
  group_by(OverallQual) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  arrange(desc(avg), desc(count)) 
```

```{r}
train %>%
  group_by(OverallQual) %>%
  summarise(count = n(),
            avg = mean(psf)) %>%
  ggplot(aes(x = OverallQual, y = count, fill = OverallQual)) +
    geom_bar(stat = "identity") +
    theme(legend.position = "none")
```





Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).
